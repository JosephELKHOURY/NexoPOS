var X=Object.defineProperty;var Z=(n,e,t)=>e in n?X(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var y=(n,e,t)=>(Z(n,typeof e!="symbol"?e+"":e,t),t);import{_ as b}from"./preload-helper-a4192956.js";import{n as ee,a as te,b as se,P as ie}from"./ns-pos-order-type-popup-92f92146.js";import{a as T,b as f,P as v,p as re,n as P,c as ne,d as oe,T as U}from"./bootstrap-f85d1704.js";import{_ as d,n as S,a as A}from"./currency-ab26e44d.js";import{_ as O}from"./_plugin-vue_export-helper-c27b6911.js";import{an as q,af as _,G as m,H as o,F as E,al as j,A as g,c as I,z as $,aH as L,M as Q,ap as ae,N as w}from"./npm~@vue~runtime-core_-19758cc2.js";import{V as c,z as F}from"./npm~@vue~shared_-951a29c4.js";import{n as H,a as le,b as ue,c as ce}from"./ns-prompt-popup-e2869fb5.js";import{h as de}from"./npm~moment-a9aaa855.js";import{P as pe}from"./ns-orders-preview-popup-39d14980.js";import{B as C}from"./npm~rxjs-eeb06f17.js";import{c as x}from"./npm~mathjs-befa2efb.js";import"./npm~@vue~runtime-dom_-725465db.js";import"./npm~@vue~reactivity_-7ae94d11.js";import"./npm~lodash-9a4afe3d.js";import"./npm~@ckeditor~ckeditor5-build-classic_-27365139.js";import"./npm~laravel-echo-198fd56d.js";import"./npm~pusher-js-bdf0b3b7.js";import"./npm~axios-c24e582b.js";import"./npm~chart.js-3fed1729.js";import"./npm~vue-34b803c9.js";import"./npm~@vue~compiler-dom_-614ecb28.js";import"./npm~@vue~compiler-core_-eb33010d.js";import"./npm~rx-da74c705.js";import"./npm~@wordpress~hooks_-bd0b7221.js";import"./npm~numeral-85b533a7.js";import"./npm~currency.js-57f74176.js";import"./npm~@ckeditor~ckeditor5-vue_-057f53f2.js";import"./npm~@dicebear~avatars_-e718895d.js";import"./npm~pure-color-7e91fe3a.js";import"./npm~svgson-b28014ad.js";import"./npm~deep-rename-keys-b2342f4f.js";import"./npm~kind-of-f578382b.js";import"./npm~is-buffer-793dba8c.js";import"./npm~rename-keys-392f1d0e.js";import"./npm~xml-reader-442daf8d.js";import"./npm~eventemitter3-3e95be7d.js";import"./npm~xml-lexer-4446ceee.js";import"./npm~@dicebear~avatars-avataaars-sprites_-c793f8f6.js";import"./npm~vue2-daterange-picker-ccd86bea.js";import"./npm~vuedraggable-c7d6faf7.js";import"./npm~sortablejs-314556ad.js";import"./npm~vue-upload-component-6f0f62ed.js";import"./npm~tslib-8dbab242.js";import"./npm~@babel~runtime_-698f0f51.js";import"./npm~decimal.js-d133ee8e.js";import"./npm~complex.js-2f8f27d8.js";import"./npm~fraction.js-704ae1f4.js";import"./npm~typed-function-de33f2d8.js";import"./npm~seedrandom-4e17e537.js";import"./npm~javascript-natural-sort-82d7d2c3.js";import"./npm~escape-latex-6c71499e.js";const _e={props:["popup"],data(){return{unitsQuantities:[],loadsUnits:!1,options:null,optionsSubscriber:null}},beforeDestroy(){this.optionsSubscriber.unsubscribe()},mounted(){this.optionsSubscriber=POS.options.subscribe(n=>{this.options=n}),this.popup.params.product.$original().selectedUnitQuantity!==void 0?this.selectUnit(this.popup.params.product.$original().selectedUnitQuantity):this.popup.params.product.$original().unit_quantities!==void 0&&this.popup.params.product.$original().unit_quantities.length===1?this.selectUnit(this.popup.params.product.$original().unit_quantities[0]):(this.loadsUnits=!0,this.loadUnits())},computed:{productName(){return this.popup.params.product.$original().name}},methods:{__:d,nsCurrency:S,displayRightPrice(n){return POS.getSalePrice(n,this.popup.params.product.$original())},loadUnits(){T.get(`/api/products/${this.popup.params.product.$original().id}/units/quantities`).subscribe(n=>{if(n.length===0)return this.popup.close(),f.error(d("This product doesn't have any unit defined for selling. Make sure to mark at least one unit as visible.")).subscribe();this.unitsQuantities=n,this.unitsQuantities.length===1&&this.selectUnit(this.unitsQuantities[0])})},selectUnit(n){if(n.unit===null)return f.error(d('The unit attached to this product is missing or not assigned. Please review the "Unit" tab for this product.')).subscribe(),this.popup.close();this.popup.params.resolve({unit_quantity_id:n.id,unit_name:n.unit.name,$quantities:()=>n}),this.popup.close()}}},me={class:"h-full w-full flex items-center justify-center",id:"ns-units-selector"},he={key:0,class:"ns-box w-4/5-screen lg:w-1/3-screen overflow-hidden flex flex-col"},fe={id:"header",class:"h-16 flex justify-center items-center flex-shrink-0"},ye={class:"font-bold text-primary"},xe={key:0,class:"grid grid-flow-row grid-cols-2 overflow-y-auto"},ge=["onClick"],be={class:"h-40 w-full flex items-center justify-center overflow-hidden"},we=["src","alt"],ve={key:1,class:"h-40 flex items-center justify-center"},Pe=o("i",{class:"las la-image text-primary text-6xl"},null,-1),Ve=[Pe],Ce={class:"h-0 w-full"},ke={class:"relative w-full flex items-center justify-center -top-10 h-20 py-2 flex-col overlay"},Te={class:"font-bold text-primary py-2 text-center"},Se={class:"text-sm font-medium text-primary"},Oe={key:1,class:"h-56 flex items-center justify-center"};function Ae(n,e,t,s,i,r){const a=q("ns-spinner");return _(),m("div",me,[i.unitsQuantities.length>0?(_(),m("div",he,[o("div",fe,[o("h3",ye,c(r.__("{product} : Units").replace("{product}",r.productName)),1)]),i.unitsQuantities.length>0?(_(),m("div",xe,[(_(!0),m(E,null,j(i.unitsQuantities,l=>(_(),m("div",{onClick:u=>r.selectUnit(l),key:l.id,class:"ns-numpad-key info cursor-pointer border flex-shrink-0 flex flex-col items-center justify-center"},[o("div",be,[l.preview_url?(_(),m("img",{key:0,src:l.preview_url,class:"object-cover h-full",alt:l.unit.name},null,8,we)):g("",!0),l.preview_url?g("",!0):(_(),m("div",ve,Ve))]),o("div",Ce,[o("div",ke,[o("h3",Te,c(l.unit.name)+" ("+c(l.quantity)+")",1),o("p",Se,c(r.nsCurrency(r.displayRightPrice(l))),1)])])],8,ge))),128))])):g("",!0)])):g("",!0),i.unitsQuantities.length===0?(_(),m("div",Oe,[I(a)])):g("",!0)])}const qe=O(_e,[["render",Ae]]);class $e{constructor(e){this.product=e}run(){return new Promise((e,t)=>{const s=this.product;v.show(qe,{resolve:e,reject:t,product:s})})}}class N{constructor(e){this.order=e}run(){return new Promise((e,t)=>this.order.customer===void 0?v.show(ee,{resolve:e,reject:t}):e(!0))}}window.CustomerQueue=N;const Ee={name:"sample-payment",props:["label","identifier"],data(){return{backValue:"0",number:parseInt(1+new Array(parseInt(ns.currency.ns_currency_precision)).fill("").map(n=>0).join("")),order:null,settings:{},settingsSubscription:null,cursor:parseInt(ns.currency.ns_currency_precision),orderSubscription:null,allSelected:!0,keys:[...[7,8,9].map(n=>({identifier:n,value:n})),...[4,5,6].map(n=>({identifier:n,value:n})),...[1,2,3].map(n=>({identifier:n,value:n})),{identifier:"backspace",icon:"la-backspace"},{identifier:0,value:0},{identifier:"next",icon:"la-share"}]}},computed:{amountShortcuts(){return nsShortcuts.ns_pos_amount_shortcut!==null?nsShortcuts.ns_pos_amount_shortcut.split("|"):[]}},mounted(){this.orderSubscription=POS.order.subscribe(e=>{this.order=e}),this.settingsSubscription=POS.settings.subscribe(e=>{this.settings=e});const n=new Array(10).fill("").map((e,t)=>t);nsHotPress.create("numpad-keys").whenVisible([".is-popup"]).whenPressed(n,(e,t)=>{this.inputValue({value:t})}),nsHotPress.create("numpad-backspace").whenVisible([".is-popup"]).whenPressed("backspace",()=>this.inputValue({identifier:"backspace"})),nsHotPress.create("numpad-save").whenVisible([".is-popup"]).whenPressed("enter",()=>{this.backValue===""?(this.$emit("submit"),this.backValue=0):this.inputValue({identifier:"next"})})},beforeDestroy(){nsHotPress.destroy("numpad-keys"),nsHotPress.destroy("numpad-backspace"),nsHotPress.destroy("numpad-save")},unmounted(){this.orderSubscription.unsubscribe()},methods:{__:d,nsCurrency:S,toggleDiscount(){if(this.settings.cart_discount!==void 0&&this.settings.cart_discount===!0)v.show(te,{reference:this.order,type:"cart",onSubmit:n=>{POS.updateCart(this.order,n)}});else return f.error(d("You're not allowed to add a discount on the cart.")).subscribe()},makeFullPayment(){v.show(H,{title:d("Confirm Full Payment"),message:d("A full payment will be made using {paymentType} for {total}").replace("{paymentType}",this.label).replace("{total}",S(this.order.total)),onAction:n=>{if(n){const e=POS.order.getValue();e.tendered<e.total&&POS.addPayment({value:this.order.total-e.tendered,identifier:this.identifier,selected:!1,label:this.label,readonly:!1}),this.$emit("submit"),this.backValue="0"}}})},increaseBy(n){let e=parseInt(1+new Array(this.cursor).fill("").map(t=>0).join(""));this.backValue=(parseFloat(n.value)*e+(parseFloat(this.backValue)||0)).toString(),this.allSelected=!1},inputValue(n){n.identifier==="next"?(POS.addPayment({value:parseFloat(this.backValue/this.number),identifier:this.identifier,selected:!1,label:this.label,readonly:!1}),this.backValue="0"):n.identifier==="backspace"?this.allSelected?(this.backValue="0",this.allSelected=!1):this.backValue=this.backValue.substr(1):n.value.toString().match(/^\d+$/)&&(this.allSelected?(this.backValue=n.value.toString(),this.allSelected=!1):(this.backValue+=n.value.toString(),this.mode==="percentage"&&(this.backValue=this.backValue>100?100:this.backValue))),this.backValue==="0"&&(this.backValue="")}}},je={class:"h-full w-full py-2"},Qe={key:0,class:"px-2 pb-2"},Ie={class:"grid grid-cols-2 gap-2"},Re={id:"details",class:"h-16 flex justify-between items-center border elevation-surface info text-xl md:text-3xl p-2"},Le={id:"paid",class:"h-16 flex justify-between items-center border elevation-surface success text-xl md:text-3xl p-2"},Fe={id:"change",class:"h-16 flex justify-between items-center border elevation-surface warning text-xl md:text-3xl p-2"},Be={id:"change",class:"col-span-2 h-16 flex justify-between items-center elevation-surface border text-xl md:text-3xl p-2"},De={class:"px-2 pb-2"},Ue={class:"-mx-2 flex flex-wrap"},We={class:"pl-2 pr-1 flex-auto"},He={id:"numpad",class:"grid grid-flow-row grid-cols-3 gap-2 grid-rows-3",style:{padding:"1px"}},Ne=["onClick"],ze={key:0},Ge={class:"w-1/2 md:w-72 pr-2 pl-1"},Me={class:"grid grid-flow-row grid-rows-1 gap-2"},Ye=["onClick"];function Ke(n,e,t,s,i,r){return _(),m("div",je,[i.order?(_(),m("div",Qe,[o("div",Ie,[o("div",Re,[o("span",null,c(r.__("Total"))+" : ",1),o("span",null,c(r.nsCurrency(i.order.total)),1)]),o("div",{id:"discount",onClick:e[0]||(e[0]=a=>r.toggleDiscount()),class:"cursor-pointer h-16 flex justify-between items-center border elevation-surface error text-xl md:text-3xl p-2"},[o("span",null,c(r.__("Discount"))+" : ",1),o("span",null,c(r.nsCurrency(i.order.discount)),1)]),o("div",Le,[o("span",null,c(r.__("Paid"))+" : ",1),o("span",null,c(r.nsCurrency(i.order.tendered)),1)]),o("div",Fe,[o("span",null,c(r.__("Change"))+" : ",1),o("span",null,c(r.nsCurrency(i.order.change)),1)]),o("div",Be,[o("span",null,c(r.__("Screen"))+" : ",1),o("span",null,c(r.nsCurrency(i.backValue/i.number)),1)])])])):g("",!0),o("div",De,[o("div",Ue,[o("div",We,[o("div",He,[(_(!0),m(E,null,j(i.keys,(a,l)=>(_(),m("div",{onClick:u=>r.inputValue(a),key:l,style:{margin:"-1px"},class:"ns-numpad-key text-2xl border h-16 flex items-center justify-center cursor-pointer"},[a.value!==void 0?(_(),m("span",ze,c(a.value),1)):g("",!0),a.icon?(_(),m("i",{key:1,class:F(["las",a.icon])},null,2)):g("",!0)],8,Ne))),128)),o("div",{onClick:e[1]||(e[1]=a=>r.makeFullPayment()),class:"hover:bg-green-500 col-span-3 bg-success-secondary border-success-tertiary text-2xl text-white border h-16 flex items-center justify-center cursor-pointer"},c(r.__("Full Payment")),1)])]),o("div",Ge,[o("div",Me,[(_(!0),m(E,null,j(r.amountShortcuts,(a,l)=>(_(),m("div",{key:l,onClick:u=>r.increaseBy({value:a}),class:"ns-numpad-key text-2xl border h-16 flex items-center justify-center cursor-pointer"},[o("span",null,c(r.nsCurrency(a)),1)],8,Ye))),128))])])])])])}const B=O(Ee,[["render",Ke]]),Je={name:"cash-payment",props:["identifier","label"],components:{samplePayment:B}};function Xe(n,e,t,s,i,r){const a=q("sample-payment");return _(),$(a,{identifier:t.identifier,label:t.label},null,8,["identifier","label"])}const Ze=O(Je,[["render",Xe]]),et={name:"creditcart-payment",props:["identifier"]};function tt(n,e,t,s,i,r){return _(),m("h1",null,"Credit Card")}const st=O(et,[["render",tt]]),it={name:"bank-payment",props:["identifier","label"],components:{samplePayment:B}};function rt(n,e,t,s,i,r){const a=q("sample-payment");return _(),$(a,{identifier:t.identifier,label:t.label},null,8,["identifier","label"])}const z=O(it,[["render",rt]]),nt=Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"})),ot={name:"ns-account-payment",components:{nsNumpad:le},props:["identifier","label"],data(){return{subscription:null,screenValue:0,order:null}},methods:{__:d,nsCurrency:S,handleChange(n){this.screenValue=n},proceedAddingPayment(n){const e=parseFloat(n),t=this.order.payments;if(e<=0)return f.error(d("Please provide a valid payment amount.")).subscribe();if(t.filter(s=>s.identifier==="account-payment").length>0)return f.error(d("The customer account can only be used once per order. Consider deleting the previously used payment.")).subscribe();if(e>this.order.customer.account_amount)return f.error(d("Not enough funds to add {amount} as a payment. Available balance {balance}.").replace("{amount}",this.$options.filters.currency(e)).replace("{balance}",this.$options.filters.currency(this.order.customer.account_amount))).subscribe();POS.addPayment({value:e,identifier:"account-payment",selected:!1,label:this.label,readonly:!1}),this.order.customer.account_amount-=e,POS.selectCustomer(this.order.customer),this.$emit("submit")},proceedFullPayment(){this.proceedAddingPayment(this.order.total)},makeFullPayment(){Popup.show(H,{title:d("Confirm Full Payment"),message:d("You're about to use {amount} from the customer account to make a payment. Would you like to proceed ?").replace("{amount}",this.$options.filters.currency(this.order.total)),onAction:n=>{n&&this.proceedFullPayment()}})}},mounted(){this.subscription=POS.order.subscribe(n=>this.order=n)},unmounted(){this.subscription.unsubscribe()}},at={class:"h-full w-full py-2"},lt={key:0,class:"px-2 pb-2"},ut={class:"grid grid-cols-2 gap-2"},ct={id:"details",class:"h-16 flex justify-between items-center elevation-surface border info text-xl md:text-3xl p-2"},dt={id:"paid",class:"h-16 flex justify-between items-center elevation-surface success border text-xl md:text-3xl p-2"},pt={id:"change",class:"h-16 flex justify-between items-center elevation-surface warning border text-xl md:text-3xl p-2"},_t={id:"change",class:"col-span-2 h-16 flex justify-between items-center elevation-surface border success text-xl md:text-3xl p-2"},mt={id:"change",class:"col-span-2 h-16 flex justify-between items-center elevation-surface border text-primary text-xl md:text-3xl p-2"},ht={class:"px-2 pb-2"},ft={class:"-mx-2 flex flex-wrap"},yt={class:"pl-2 pr-1 flex-auto"},xt={class:"w-1/2 md:w-72 pr-2 pl-1"},gt={class:"grid grid-flow-row grid-rows-1 gap-2"};function bt(n,e,t,s,i,r){const a=q("ns-numpad");return _(),m("div",at,[i.order?(_(),m("div",lt,[o("div",ut,[o("div",ct,[o("span",null,c(r.__("Total"))+" : ",1),o("span",null,c(r.nsCurrency(i.order.total)),1)]),o("div",{id:"discount",onClick:e[0]||(e[0]=l=>n.toggleDiscount()),class:"cursor-pointer h-16 flex justify-between items-center elevation-surface error border text-xl md:text-3xl p-2"},[o("span",null,c(r.__("Discount"))+" : ",1),o("span",null,c(r.nsCurrency(i.order.discount)),1)]),o("div",dt,[o("span",null,c(r.__("Paid"))+" : ",1),o("span",null,c(r.nsCurrency(i.order.tendered)),1)]),o("div",pt,[o("span",null,c(r.__("Change"))+" : ",1),o("span",null,c(r.nsCurrency(i.order.change)),1)]),o("div",_t,[o("span",null,c(r.__("Current Balance"))+" : ",1),o("span",null,c(r.nsCurrency(i.order.customer.account_amount)),1)]),o("div",mt,[o("span",null,c(r.__("Screen"))+" : ",1),o("span",null,c(r.nsCurrency(i.screenValue)),1)])])])):g("",!0),o("div",ht,[o("div",ft,[o("div",yt,[I(a,{floating:!0,onChanged:e[2]||(e[2]=l=>r.handleChange(l)),onNext:e[3]||(e[3]=l=>r.proceedAddingPayment(l))},{"numpad-footer":L(()=>[o("div",{onClick:e[1]||(e[1]=l=>r.makeFullPayment()),class:"hover:bg-success-tertiary col-span-3 bg-success-secondary text-2xl text-white border border-success-secondary h-16 flex items-center justify-center cursor-pointer"},c(r.__("Full Payment")),1)]),_:1})]),o("div",xt,[o("div",gt,[o("div",{onClick:e[4]||(e[4]=l=>n.increaseBy({value:100})),class:"elevation-surface border hoverable text-2xl text-primary h-16 flex items-center justify-center cursor-pointer"},[o("span",null,c(r.nsCurrency(100)),1)]),o("div",{onClick:e[5]||(e[5]=l=>n.increaseBy({value:500})),class:"elevation-surface border hoverable text-2xl text-primary h-16 flex items-center justify-center cursor-pointer"},[o("span",null,c(r.nsCurrency(500)),1)]),o("div",{onClick:e[6]||(e[6]=l=>n.increaseBy({value:1e3})),class:"elevation-surface border hoverable text-2xl text-primary h-16 flex items-center justify-center cursor-pointer"},[o("span",null,c(r.nsCurrency(1e3)),1)])])])])])])}const G=O(ot,[["render",bt]]),wt=Object.freeze(Object.defineProperty({__proto__:null,default:G},Symbol.toStringTag,{value:"Module"})),vt={name:"ns-pos-payment",props:["popup"],data(){return{paymentTypesSubscription:null,paymentsType:[],order:null,showPayment:!1,orderSubscription:null,currentPaymentComponent:null,activePaymentSubscription:null}},computed:{expectedPayment(){const n=this.order.customer.group.minimal_credit_payment;return this.order.total*n/100}},mounted(){this.order=this.popup.params.order,this.activePaymentSubscription=POS.selectedPaymentType.subscribe(n=>{this.activePayment=n,n!==null&&this.loadPaymentComponent(n)}),this.paymentTypesSubscription=POS.paymentsType.subscribe(n=>{this.paymentsType=n,n.filter(e=>{e.selected&&POS.selectedPaymentType.next(e)})}),nsHooks.doAction("ns-pos-payment-mounted",this)},unmounted(){this.activePaymentSubscription.unsubscribe(),this.paymentTypesSubscription.unsubscribe(),nsHooks.doAction("ns-pos-payment-destroyed",this)},methods:{__:d,nsCurrency:S,resolveIfQueued:re,loadPaymentComponent(n){switch(n.identifier){case"cash-payment":this.currentPaymentComponent=shallowRef(Ze);break;case"creditcard-payment":this.currentPaymentComponent=shallowRef(st);break;case"bank-payment":this.currentPaymentComponent=shallowRef(z);break;case"account-payment":this.currentPaymentComponent=shallowRef(G);break;default:this.currentPaymentComponent=shallowRef(B);break}},async selectPayment(){try{const n=await new Promise((e,t)=>{v.show(ue,{label:d("Select Payment Gateway"),options:this.paymentsType.map(s=>({label:s.label,value:s.identifier})),value:this.activePayment.identifier,resolve:e,reject:t})});this.select(this.paymentsType.filter(e=>e.identifier===n[0].value)[0])}catch{}},select(n){this.showPayment=!1,POS.setPaymentActive(n)},closePopup(){this.popup.close(),POS.selectedPaymentType.next(null)},deletePayment(n){POS.removePayment(n)},selectPaymentAsActive(n){this.select(this.paymentsType.filter(e=>e.identifier===n.target.value)[0])},submitOrder(n={}){const e=v.show(ce);try{const t={...POS.order.getValue(),...n};POS.submitOrder(t).then(s=>{e.close(),f.success(s.message).subscribe(),POS.printOrderReceipt(s.data.order,"silent"),this.popup.close()},s=>{e.close(),f.error(s.message).subscribe()})}catch{e.close(),f.error(error.message).subscribe()}}}},Pt={key:0,id:"ns-payment-popup",class:"w-screen h-screen p-4 flex overflow-hidden"},Vt={class:"flex flex-col flex-auto lg:flex-row shadow-xl"},Ct={class:"w-full lg:w-56 lg:h-full flex justify-between px-2 lg:px-0 lg:block items-center lg:items-start"},kt={class:"lg:hidden text-xl text-center my-4 font-bold lg:my-8"},Tt=o("div",{class:"h-16 hidden lg:block"},null,-1),St={class:"hidden lg:block"},Ot=["onClick"],At={class:"px-2 rounded-full h-8 w-8 flex items-center justify-center ns-label"},qt={class:"overflow-hidden flex flex-col flex-auto"},$t={class:"flex flex-col flex-auto overflow-hidden"},Et={class:"h-12 hidden items-center justify-between lg:flex"},jt={class:"text-xl hidden lg:block text-center my-4 font-bold lg:my-8"},Qt={class:"hidden-md"},It={class:"px-2"},Rt={key:0,class:"flex flex-auto ns-payment-wrapper overflow-y-auto"},Lt={key:1,class:"flex flex-auto ns-payment-wrapper overflow-y-auto p-2 flex-col"},Ft={class:"text-center font-bold py-2"},Bt={class:"flex-auto"},Dt={key:0,class:"p-2 flex justify-center mb-2 items-center"},Ut={class:"font-semibold"},Wt={class:"flex items-center"},Ht=["onClick"],Nt=o("i",{class:"las la-trash-alt"},null,-1),zt=[Nt],Gt={class:"flex lg:hidden ns-payment-buttons"},Mt={class:"text-sm"},Yt={class:"text-sm"},Kt={class:"text-sm"},Jt={class:"text-sm mr-1"},Xt={class:"px-2 rounded-full h-6 w-6 text-xs flex items-center justify-center ns-label"},Zt={class:"flex-col sm:flex-row w-full ns-payment-footer justify-end p-2 hidden lg:flex"},es={class:"flex justify-end"},ts=o("i",{class:"las la-cash-register"},null,-1),ss=o("i",{class:"las la-bookmark"},null,-1);function is(n,e,t,s,i,r){const a=q("ns-close-button"),l=q("ns-button");return i.order?(_(),m("div",Pt,[o("div",Vt,[o("div",Ct,[o("h3",kt,[Q(c(r.__("Gateway"))+" ",1),o("span",null,": "+c(n.activePayment.label),1)]),Tt,o("ul",St,[(_(!0),m(E,null,j(i.paymentsType,u=>(_(),m("li",{onClick:h=>r.select(u),class:F([u.selected&&!i.showPayment?"ns-visible":"","cursor-pointer ns-payment-gateway py-2 px-3"]),key:u.identifier},c(u.label),11,Ot))),128)),o("li",{onClick:e[0]||(e[0]=u=>i.showPayment=!0),class:F([i.showPayment?"ns-visible":"","cursor-pointer py-2 px-3 ns-payment-list border-t mt-4 flex items-center justify-between"])},[o("span",null,c(r.__("Payment List")),1),o("span",At,c(i.order.payments.length),1)],2)]),I(a,{class:"lg:hidden",onClick:e[1]||(e[1]=u=>r.closePopup())})]),o("div",qt,[o("div",$t,[o("div",Et,[o("div",null,[o("h3",jt,[Q(c(r.__("Gateway"))+" ",1),o("span",Qt,": "+c(n.activePayment.label),1)])]),o("div",It,[I(a,{onClick:e[2]||(e[2]=u=>r.closePopup())})])]),i.showPayment?g("",!0):(_(),m("div",Rt,[(_(),$(ae(i.currentPaymentComponent),{onSubmit:e[3]||(e[3]=u=>r.submitOrder()),label:n.activePayment.label,identifier:n.activePayment.identifier},null,40,["label","identifier"]))])),i.showPayment?(_(),m("div",Lt,[o("h3",Ft,c(r.__("List Of Payments")),1),o("ul",Bt,[i.order.payments.length===0?(_(),m("li",Dt,[o("h3",Ut,c(r.__("No Payment added.")),1)])):g("",!0),(_(!0),m(E,null,j(i.order.payments,(u,h)=>(_(),m("li",{key:h,class:"p-2 flex justify-between mb-2 items-center"},[o("span",null,c(u.label),1),o("div",Wt,[o("span",null,c(r.nsCurrency(u.value)),1),o("button",{onClick:p=>r.deletePayment(u),class:"rounded-full h-8 w-8 flex items-center justify-center ml-2"},zt,8,Ht)])]))),128))])])):g("",!0)]),o("div",Gt,[o("button",{onClick:e[4]||(e[4]=u=>r.selectPayment()),class:"flex items-center justify-center w-1/3 text-2xl flex-auto h-12 font-bold ns-payment-type-button"},[o("span",Mt,c(r.__("Payment Type")),1)]),i.order.tendered>=i.order.total?(_(),m("button",{key:0,onClick:e[5]||(e[5]=u=>r.submitOrder()),class:"flex items-center justify-center w-1/3 text-2xl flex-auto h-12 ns-submit-button font-bold"},[o("span",Yt,c(r.__("Submit Payment")),1)])):g("",!0),i.order.tendered<i.order.total?(_(),m("button",{key:1,onClick:e[6]||(e[6]=u=>r.submitOrder({payment_status:"unpaid"})),class:"flex items-center justify-center w-1/3 text-2xl flex-auto h-12 ns-layaway-button font-bold"},[o("span",Kt,c(r.__("Layaway")),1)])):g("",!0),o("button",{onClick:e[7]||(e[7]=u=>i.showPayment=!0),class:"w-1/3 flex ns-payment-button text-2xl flex-auto h-12 items-center justify-center font-bold"},[o("span",Jt,c(r.__("Payment List")),1),o("span",Xt,c(i.order.payments.length),1)])]),o("div",Zt,[o("div",es,[i.order.tendered>=i.order.total?(_(),$(l,{key:0,onClick:e[8]||(e[8]=u=>r.submitOrder()),type:i.order.tendered>=i.order.total?"success":"info"},{default:L(()=>[o("span",null,[ts,Q(" "+c(r.__("Submit Payment")),1)])]),_:1},8,["type"])):g("",!0),i.order.tendered<i.order.total?(_(),$(l,{key:1,onClick:e[9]||(e[9]=u=>r.submitOrder({payment_status:"unpaid"})),type:i.order.tendered>=i.order.total?"success":"info"},{default:L(()=>[o("span",null,[ss,Q(" "+c(r.__("Layaway"))+" — "+c(r.nsCurrency(r.expectedPayment)),1)])]),_:1},8,["type"])):g("",!0)])])])])])):g("",!0)}const rs=O(vt,[["render",is]]);class M{constructor(e){this.order=e}run(){return new Promise((e,t)=>{v.show(rs,{resolve:e,reject:t,order:this.order})})}}window.PaymentQueue=M;class Y{constructor(e){this.order=e}run(){return new Promise((e,t)=>this.order.products.length===0?(f.error(d("You need to provide some products before proceeding.")).subscribe(),t(!1)):e(!0))}}window.ProductsQueue=Y;class K{constructor(e){this.order=e}run(){return new Promise((e,t)=>{if(this.order.type===void 0)return v.show(se,{resolve:e,reject:t});e(!0)})}}window.TypeQueue=K;class os{constructor(){y(this,"screenIs");this.detect()}detect(){window.innerWidth<544?this.screenIs="xs":window.innerWidth>=544&&window.innerWidth<768?this.screenIs="sm":window.innerWidth>=768&&window.innerWidth<992?this.screenIs="md":window.innerWidth>=992&&window.innerWidth<1200?this.screenIs="lg":window.innerWidth>=1200&&(this.screenIs="xl")}is(e){return e===void 0?this.screenIs:this.screenIs===e}}const as=window.nsPosDashboardButton=w(()=>b(()=>import("./ns-pos-dashboard-button-16a2e131.js"),["./ns-pos-dashboard-button-16a2e131.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~currency.js-57f74176.js","./_plugin-vue_export-helper-c27b6911.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js"],import.meta.url)),ls=window.nsPosPendingOrderButton=w(()=>b(()=>import("./ns-pos-pending-orders-button-25a8b8cd.js"),["./ns-pos-pending-orders-button-25a8b8cd.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./npm~rx-da74c705.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js","./ns-prompt-popup-e2869fb5.js","./npm~@ckeditor~ckeditor5-vue_-057f53f2.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url)),us=window.nsPosOrderTypeButton=w(()=>b(()=>import("./ns-pos-order-type-button-5e0e3cab.js"),["./ns-pos-order-type-button-5e0e3cab.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./npm~rx-da74c705.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js","./ns-pos-order-type-popup-92f92146.js","./ns-prompt-popup-e2869fb5.js","./npm~@ckeditor~ckeditor5-vue_-057f53f2.js","./_plugin-vue_export-helper-c27b6911.js","./ns-orders-preview-popup-39d14980.js","./npm~@dicebear~avatars_-e718895d.js","./npm~pure-color-7e91fe3a.js","./npm~svgson-b28014ad.js","./npm~deep-rename-keys-b2342f4f.js","./npm~kind-of-f578382b.js","./npm~is-buffer-793dba8c.js","./npm~rename-keys-392f1d0e.js","./npm~xml-reader-442daf8d.js","./npm~eventemitter3-3e95be7d.js","./npm~xml-lexer-4446ceee.js","./npm~@dicebear~avatars-avataaars-sprites_-c793f8f6.js","./npm~vue2-daterange-picker-ccd86bea.js","./npm~vue2-daterange-picker-b4959dd3.css","./npm~vuedraggable-c7d6faf7.js","./npm~sortablejs-314556ad.js","./npm~vue-upload-component-6f0f62ed.js"],import.meta.url)),cs=window.nsPosCustomersButton=w(()=>b(()=>import("./ns-pos-customers-button-ba93efbe.js"),["./ns-pos-customers-button-ba93efbe.js","./preload-helper-a4192956.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./npm~rx-da74c705.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url)),ds=window.nsPosResetButton=w(()=>b(()=>import("./ns-pos-reset-button-745234ad.js"),["./ns-pos-reset-button-745234ad.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./npm~rx-da74c705.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js","./_plugin-vue_export-helper-c27b6911.js","./ns-prompt-popup-e2869fb5.js","./npm~@ckeditor~ckeditor5-vue_-057f53f2.js","./npm~@dicebear~avatars_-e718895d.js","./npm~pure-color-7e91fe3a.js","./npm~svgson-b28014ad.js","./npm~deep-rename-keys-b2342f4f.js","./npm~kind-of-f578382b.js","./npm~is-buffer-793dba8c.js","./npm~rename-keys-392f1d0e.js","./npm~xml-reader-442daf8d.js","./npm~eventemitter3-3e95be7d.js","./npm~xml-lexer-4446ceee.js","./npm~@dicebear~avatars-avataaars-sprites_-c793f8f6.js","./npm~vue2-daterange-picker-ccd86bea.js","./npm~vue2-daterange-picker-b4959dd3.css","./npm~vuedraggable-c7d6faf7.js","./npm~sortablejs-314556ad.js","./npm~vue-upload-component-6f0f62ed.js"],import.meta.url)),ps=window.nsPosCashRegister=w(()=>b(()=>import("./ns-pos-registers-button-cea352db.js"),["./ns-pos-registers-button-cea352db.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./npm~rx-da74c705.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js","./ns-prompt-popup-e2869fb5.js","./npm~@ckeditor~ckeditor5-vue_-057f53f2.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url)),_s=window.nsAlertPopup=w(()=>b(()=>import("./ns-alert-popup-14b2e47f.js"),["./ns-alert-popup-14b2e47f.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~currency.js-57f74176.js","./_plugin-vue_export-helper-c27b6911.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js"],import.meta.url)),W=window.nsConfirmPopup=w(()=>b(()=>import("./ns-prompt-popup-e2869fb5.js").then(n=>n.j),["./ns-prompt-popup-e2869fb5.js","./npm~@ckeditor~ckeditor5-vue_-057f53f2.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./_plugin-vue_export-helper-c27b6911.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~rx-da74c705.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js"],import.meta.url));window.nsPOSLoadingPopup=w(()=>b(()=>import("./ns-prompt-popup-e2869fb5.js").then(n=>n.k),["./ns-prompt-popup-e2869fb5.js","./npm~@ckeditor~ckeditor5-vue_-057f53f2.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./_plugin-vue_export-helper-c27b6911.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~rx-da74c705.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js"],import.meta.url));const ms=window.nsPromptPopup=w(()=>b(()=>import("./ns-prompt-popup-e2869fb5.js").then(n=>n.l),["./ns-prompt-popup-e2869fb5.js","./npm~@ckeditor~ckeditor5-vue_-057f53f2.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./_plugin-vue_export-helper-c27b6911.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~rx-da74c705.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js"],import.meta.url)),hs=window.nsLayawayPopup=w(()=>b(()=>import("./ns-pos-layaway-popup-c61bb3e6.js"),["./ns-pos-layaway-popup-c61bb3e6.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./npm~rx-da74c705.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url)),fs=window.nsPosShippingPopup=w(()=>b(()=>import("./ns-pos-shipping-popup-8848dfa9.js"),["./ns-pos-shipping-popup-8848dfa9.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./npm~rx-da74c705.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js","./_plugin-vue_export-helper-c27b6911.js"],import.meta.url));window.CustomerQueue=N;window.PaymentQueue=M;window.ProductsQueue=Y;window.TypeQueue=K;window.nsPosDiscountPopup=w(()=>b(()=>import("./ns-pos-order-type-popup-92f92146.js").then(n=>n.e),["./ns-pos-order-type-popup-92f92146.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./npm~rx-da74c705.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js","./ns-prompt-popup-e2869fb5.js","./npm~@ckeditor~ckeditor5-vue_-057f53f2.js","./_plugin-vue_export-helper-c27b6911.js","./ns-orders-preview-popup-39d14980.js","./npm~@dicebear~avatars_-e718895d.js","./npm~pure-color-7e91fe3a.js","./npm~svgson-b28014ad.js","./npm~deep-rename-keys-b2342f4f.js","./npm~kind-of-f578382b.js","./npm~is-buffer-793dba8c.js","./npm~rename-keys-392f1d0e.js","./npm~xml-reader-442daf8d.js","./npm~eventemitter3-3e95be7d.js","./npm~xml-lexer-4446ceee.js","./npm~@dicebear~avatars-avataaars-sprites_-c793f8f6.js","./npm~vue2-daterange-picker-ccd86bea.js","./npm~vue2-daterange-picker-b4959dd3.css","./npm~vuedraggable-c7d6faf7.js","./npm~sortablejs-314556ad.js","./npm~vue-upload-component-6f0f62ed.js"],import.meta.url));window.BankPayment=w(()=>b(()=>Promise.resolve().then(()=>nt),void 0,import.meta.url));window.AccountPayment=w(()=>b(()=>Promise.resolve().then(()=>wt),void 0,import.meta.url));window.nsPosLoadingPopupVue=w(()=>b(()=>import("./ns-prompt-popup-e2869fb5.js").then(n=>n.k),["./ns-prompt-popup-e2869fb5.js","./npm~@ckeditor~ckeditor5-vue_-057f53f2.js","./npm~@ckeditor~ckeditor5-build-classic_-27365139.js","./npm~vue-34b803c9.js","./npm~@vue~runtime-dom_-725465db.js","./npm~@vue~runtime-core_-19758cc2.js","./npm~@vue~reactivity_-7ae94d11.js","./npm~@vue~shared_-951a29c4.js","./npm~@vue~compiler-dom_-614ecb28.js","./npm~@vue~compiler-core_-eb33010d.js","./currency-ab26e44d.js","./npm~numeral-85b533a7.js","./npm~currency.js-57f74176.js","./_plugin-vue_export-helper-c27b6911.js","./bootstrap-f85d1704.js","./npm~lodash-9a4afe3d.js","./npm~laravel-echo-198fd56d.js","./npm~pusher-js-bdf0b3b7.js","./npm~axios-c24e582b.js","./npm~chart.js-3fed1729.js","./npm~rxjs-eeb06f17.js","./npm~tslib-8dbab242.js","./npm~moment-a9aaa855.js","./npm~rx-da74c705.js","./npm~@wordpress~hooks_-bd0b7221.js","./npm~mathjs-befa2efb.js","./npm~@babel~runtime_-698f0f51.js","./npm~decimal.js-d133ee8e.js","./npm~complex.js-2f8f27d8.js","./npm~fraction.js-704ae1f4.js","./npm~typed-function-de33f2d8.js","./npm~seedrandom-4e17e537.js","./npm~javascript-natural-sort-82d7d2c3.js","./npm~escape-latex-6c71499e.js"],import.meta.url));let J=class{constructor(){y(this,"_cartButtons");y(this,"_products");y(this,"_breadcrumbs");y(this,"_customers");y(this,"_settings");y(this,"_types");y(this,"_orderTypeProcessQueue",[]);y(this,"_paymentsType");y(this,"_order");y(this,"_screen");y(this,"_holdPopupEnabled",!0);y(this,"_initialQueue",[]);y(this,"_options");y(this,"_responsive",new os);y(this,"_visibleSection");y(this,"_isSubmitting",!1);y(this,"_processingAddQueue",!1);y(this,"_selectedPaymentType");y(this,"print");y(this,"defaultOrder",()=>({discount_type:null,title:"",discount:0,register_id:this.get("register")?this.get("register").id:void 0,discount_percentage:0,subtotal:0,total:0,coupons:[],total_coupons:0,tendered:0,note:"",note_visibility:"hidden",tax_group_id:void 0,tax_type:void 0,taxes:[],tax_groups:[],payment_status:void 0,customer_id:void 0,change:0,total_products:0,shipping:0,tax_value:0,products_exclusive_tax_value:0,products_inclusive_tax_value:0,total_tax_value:0,shipping_rate:0,shipping_type:void 0,customer:void 0,type:void 0,products:[],instalments:[],payments:[],addresses:{shipping:void 0,billing:void 0}}));y(this,"addToCartQueue",[$e,ie]);this.initialize(),this.print=new pe({urls:systemUrls,options:systemOptions})}get screen(){return this._screen}get visibleSection(){return this._visibleSection}get paymentsType(){return this._paymentsType}get selectedPaymentType(){return this._selectedPaymentType}get order(){return this._order}get types(){return this._types}get products(){return this._products}get customers(){return this._customers}get options(){return this._options}get orderTypeQueue(){return this._orderTypeProcessQueue}get settings(){return this._settings}get breadcrumbs(){return this._breadcrumbs}get initialQueue(){return this._initialQueue}get responsive(){return this._responsive}get processingAddQueue(){return this._processingAddQueue}get cartButtons(){return this._cartButtons}async reset(){this._isSubmitting=!1,this.order.next(this.defaultOrder()),this.products.next([]),this._customers.next([]),this._breadcrumbs.next([]),this._cartButtons.next({}),this.defineCurrentScreen(),this.setHoldPopupEnabled(!0),await this.processInitialQueue(),P.doAction("ns-after-cart-changed"),P.doAction("ns-after-cart-reset")}initialize(){this._products=new C([]),this._customers=new C([]),this._types=new C([]),this._breadcrumbs=new C([]),this._screen=new C(""),this._paymentsType=new C([]),this._visibleSection=new C("both"),this._options=new C({}),this._settings=new C({}),this._order=new C(this.defaultOrder()),this._selectedPaymentType=new C(null),this._cartButtons=new C({}),this._orderTypeProcessQueue=[{identifier:"handle.delivery-order",promise:e=>new Promise((t,s)=>e&&e.identifier==="delivery"?v.show(fs,{resolve:t,reject:s}):t({status:"success",message:"Proceed"}))}],this.initialQueue.push(()=>new Promise((e,t)=>{const s=this.options.getValue(),i=this.order.getValue();return i.tax_type=s.ns_pos_tax_type,s.ns_pos_tax_group!==!1&&(i.tax_group_id=s.ns_pos_tax_group,this.order.next(i)),e({status:"success",message:"tax group assignated"})})),this.initialQueue.push(()=>new Promise((e,t)=>{const s=this.options.getValue();return this.order.getValue(),s.ns_customers_default!==!1&&T.get(`/api/customers/${s.ns_customers_default}`).subscribe({next:i=>{this.selectCustomer(i),e({status:"success",message:d("The customer has been loaded")})},error:i=>{ne.error(d("An error has occured"),d("Unable to select the default customer. Looks like the customer no longer exists. Consider changing the default customer on the settings."),{actions:{readMore:{label:d("Read More"),onClick:r=>{r.close(),window.open("https://my.nexopos.com/en/documentation/troubleshooting/no-default-customer","_blank")}},close:{label:d("Close")}}}),t(i)}}),e({status:"success",message:"tax group assignated"})})),P.addAction("ns-after-cart-changed","listen-add-to-cart",()=>this.refreshCart()),this.types.subscribe(e=>{const t=Object.values(e).filter(s=>s.selected);if(t.length>0){const s=this.order.getValue();s.type=t[0],this.order.next(s)}}),window.addEventListener("resize",()=>{this._responsive.detect(),this.defineCurrentScreen()}),window.onbeforeunload=()=>{if(this.products.getValue().length>0)return d("Some products has been added to the cart. Would youl ike to discard this order ?")}}getSalePrice(e,t){return this.options.getValue().ns_pos_price_with_tax==="yes"?A(e.sale_price_with_tax):A(e.sale_price_without_tax)}getCustomPrice(e,t){return this.options.getValue().ns_pos_price_with_tax==="yes"?A(e.custom_price_with_tax):A(e.custom_price_without_tax)}getWholesalePrice(e,t){return this.options.getValue().ns_pos_price_with_tax==="yes"?A(e.wholesale_price_with_tax):A(e.wholesale_price_without_tax)}setHoldPopupEnabled(e=!0){this._holdPopupEnabled=e}getHoldPopupEnabled(){return this._holdPopupEnabled}async processInitialQueue(){for(let e in this._initialQueue)try{const t=await this._initialQueue[e]()}catch(t){f.error(t.message).subscribe()}}removeCoupon(e){const t=this.order.getValue(),s=t.coupons,i=s.indexOf(e);s.splice(i,1),t.coupons=s,this.order.next(t)}pushCoupon(e){const t=this.order.getValue();t.coupons.forEach(s=>{if(s.code===e.code){const i=d("This coupon is already added to the cart");throw f.error(i).subscribe(),i}}),t.coupons.push(e),this.order.next(t),this.refreshCart()}get header(){const e={buttons:{nsPosDashboardButton:as,nsPosPendingOrderButton:ls,nsPosOrderTypeButton:us,nsPosCustomersButton:cs,nsPosResetButton:ds}};return this.options.getValue().ns_pos_registers_enabled==="yes"&&(e.buttons.nsPosCashRegister=ps),P.doAction("ns-pos-header",e),e}defineOptions(e){this._options.next(e)}defineCurrentScreen(){this._visibleSection.next(["xs","sm"].includes(this._responsive.is())?"grid":"both"),this._screen.next(this._responsive.is())}changeVisibleSection(e){["both","cart","grid"].includes(e)&&(["cart","both"].includes(e)&&this.refreshCart(),this._visibleSection.next(e))}addPayment(e){if(e.value>0){const t=this._order.getValue();return t.payments.push(e),this._order.next(t),this.computePaid()}return f.error("Invalid amount.").subscribe()}removePayment(e){if(e.id!==void 0)return f.error(d("Unable to delete a payment attached to the order.")).subscribe();const t=this._order.getValue(),s=t.payments.indexOf(e);t.payments.splice(s,1),this._order.next(t),oe.emit({identifier:"ns.pos.remove-payment",value:e}),this.updateCustomerAccount(e),this.computePaid()}updateCustomerAccount(e){if(e.identifier==="account-payment"){const t=this.order.getValue().customer;t.account_amount+=e.value,this.selectCustomer(t)}}getPriceWithoutTax(e,t,s){if(s==="inclusive")return U.computeInclusive(e,t);if(s==="exclusive")return e}getPriceWithTax(e,t,s){if(s==="inclusive")return e;if(s==="exclusive")return U.computeExclusive(e,t)}getVatValue(e,t,s){return s==="inclusive"?e-this.getPriceWithoutTax(e,t,s):s==="exclusive"?this.getPriceWithTax(e,t,s)-e:0}computeTaxes(){return new Promise((e,t)=>{let s=this.order.getValue();if(s=this.computeProductsTaxes(s),s.tax_group_id===void 0||s.tax_group_id===null)return this.computeOrderTaxes(s),e({data:{order:s},status:"success"});const i=s.tax_groups;if(Object.values(i).length>0)return i[s.tax_group_id]!==void 0&&(s=this.computeOrderTaxGroup(s,i[s.tax_group_id])),e({status:"success",data:{tax:i[s.tax_group_id],order:s}});if(s.tax_group_id!==void 0&&s.tax_group_id.toString().length>0)T.get(`/api/taxes/groups/${s.tax_group_id}`).subscribe({next:r=>(s=this.computeOrderTaxGroup(s,r),e({status:"success",data:{tax:r,order:s}})),error:r=>t(r)});else return t({status:"failed",message:d("No tax group assigned to the order")})})}computeOrderTaxGroup(e,t){const s=t.taxes.map(r=>parseFloat(r.rate)).reduce((r,a)=>r+a),i=this.getVatValue(e.subtotal-e.discount,s,e.tax_type);return t.taxes=t.taxes.map(r=>{const a=x(x(r.rate).divide(s).done()).multiply(100).done();return{id:r.id,name:r.name,rate:parseFloat(r.rate),tax_value:x(x(i).multiply(a).done()).divide(100).done()}}),t.taxes.length===0?f.error(d("The selected tax group doesn't have any assigned sub taxes. This might cause wrong figures."),d("Proceed"),{duration:!1}).subscribe():(e.tax_groups=e.tax_groups||[],e.taxes=t.taxes,e.tax_groups[t.id]=t,this.computeOrderTaxes(e))}computeOrderTaxes(e){const t=this.options.getValue().ns_pos_vat,s=this.options.getValue().ns_pos_price_with_tax==="yes";return["flat_vat","variable_vat","products_variable_vat","products_flat_vat"].includes(t)&&e.taxes&&e.taxes.length>0&&(e.tax_value+=e.taxes.map(i=>i.tax_value).reduce((i,r)=>i+r)),e.total_tax_value=e.tax_value,["products_variable_vat","products_flat_vat","products_vat"].includes(t)&&!s&&(e.total_tax_value=e.products_exclusive_tax_value+e.tax_value),e}computeProductsTaxes(e){const t=this.products.getValue(),s=t.filter(a=>a.tax_type==="inclusive").map(a=>a.tax_value),i=t.filter(a=>a.tax_type==="exclusive").map(a=>a.tax_value);e.products_exclusive_tax_value=0,e.products_inclusive_tax_value=0;const r=this.options.getValue().ns_pos_vat;return["products_flat_vat","products_variable_vat","products_vat"].includes(r)&&i.length>0&&(e.products_exclusive_tax_value+=i.reduce((a,l)=>a+l)),["products_flat_vat","products_variable_vat","products_vat"].includes(r)&&s.length>0&&(e.products_inclusive_tax_value+=s.reduce((a,l)=>a+l)),e.products=t,e.total_products=t.length,e}canProceedAsLaidAway(e){return new Promise(async(t,s)=>{const i=e.customer.group.minimal_credit_payment;let r=(e.total*i/100).toFixed(ns.currency.ns_currency_precision);r=parseFloat(r);try{const a=await new Promise((l,u)=>{v.show(hs,{order:e,reject:u,resolve:l})});if(a.order.instalments.length===0&&a.order.tendered<r){const l=d("Before saving this order, a minimum payment of {amount} is required").replace("{amount}",S(r));return v.show(_s,{title:d("Unable to proceed"),message:l}),s({status:"failed",message:l})}else{const l=this.selectedPaymentType.getValue(),u=a.order.instalments.filter(p=>p.amount>=r&&de(p.date).isSame(ns.date.moment.startOf("day"),"day"));if(u.length===0)return t({status:"success",message:d("Layaway defined"),data:{order:a.order}});const h=u[0].amount;h>0?v.show(W,{title:d("Initial Payment"),message:d('In order to proceed, an initial payment of {amount} is required for the selected payment type "{paymentType}". Would you like to proceed ?').replace("{amount}",S(h)).replace("{paymentType}",l.label),onAction:p=>{if(p){const k={identifier:l.identifier,label:l.label,value:h,readonly:!1,selected:!0};this.addPayment(k),u[0].paid=!0,t({status:"success",message:d("Layaway defined"),data:{order:a.order}})}else s({status:"failed",message:d("The request was canceled")})}}):t({status:"success",message:d("Layaway defined"),data:{order:a.order}})}}catch(a){return s(a)}})}submitOrder(e={}){return new Promise(async(t,s)=>{var i={...this.order.getValue(),...e};const r=i.customer.group.minimal_credit_payment;if(i.payment_status!=="hold"&&i.payments.length===0&&i.total>0&&i.total>i.tendered){if(this.options.getValue().ns_orders_allow_partial==="no"){const a=d("Partially paid orders are disabled.");return s({status:"failed",message:a})}else if(r>=0)try{i=(await this.canProceedAsLaidAway(i)).data.order}catch(a){return s(a)}}if(!this._isSubmitting){const a=i.id!==void 0?"put":"post";return this._isSubmitting=!0,T[a](`/api/orders${i.id!==void 0?"/"+i.id:""}`,i).subscribe({next:l=>{t(l),this.reset(),P.doAction("ns-order-submit-successful",l),this._isSubmitting=!1;const u=this.options.getValue().ns_pos_complete_sale_audio;u.length>0&&new Audio(u).play()},error:l=>{this._isSubmitting=!1,s(l),P.doAction("ns-order-submit-failed",l)}})}return s({status:"failed",message:d("An order is currently being processed.")})})}defineQuantities(e,t=[]){return new Promise((s,i)=>{const a={unit:t.filter(u=>u.id===e.unit_id)[0]||{},sale_price_with_tax:e.mode==="normal"?parseFloat(e.price_with_tax):0,sale_price_without_tax:e.mode==="normal"?parseFloat(e.price_without_tax):0,sale_price:e.mode==="normal"?parseFloat(e.unit_price):0,sale_price_tax:e.mode==="normal"?e.tax_value:0,sale_price_edit:0,wholesale_price_with_tax:e.mode==="wholesale"?parseFloat(e.price_with_tax):0,wholesale_price_without_tax:e.mode==="wholesale"?parseFloat(e.price_without_tax):0,wholesale_price:e.mode==="wholesale"?parseFloat(e.unit_price):0,wholesale_price_tax:e.mode==="wholesale"?e.tax_value:0,wholesale_price_edit:0,custom_price_with_tax:e.mode==="custom"?parseFloat(e.price_with_tax):0,custom_price_without_tax:e.mode==="custom"?parseFloat(e.price_without_tax):0,custom_price:e.mode==="custom"?parseFloat(e.unit_price):0,custom_price_tax:e.mode==="custom"?e.tax_value:0,custom_price_edit:e.mode==="custom"?parseFloat(e.unit_price):0};let l;if(["inclusive","exclusive"].includes(e.tax_type))try{if(e.tax_group_id)T.get(`/api/taxes/groups/${e.tax_group_id}`).subscribe({next:u=>(["sale","wholesale","custom"].forEach(h=>{a[h+"_price_tax"]=u.taxes.map(p=>this.getVatValue(a[h+"_price"],p.rate,e.tax_type)).reduce((p,k)=>p+k),a["gross_"+h+"_price"]=a[h+"_price"]+a[h+"_price_tax"],a["net_"+h+"_price"]=a[h+"_price"]-a[h+"_price_tax"]}),l=u,s(a)),error:u=>{i(!1)}});else return a.sale_price_tax=0,a.wholesale_price_tax=0,a.sale_price_without_tax=e.unit_price,s(a)}catch{return f.error(d("An error has occurred while computing the product.")).subscribe()}return s(a)})}loadOrder(e){return new Promise((t,s)=>{T.get(`/api/orders/${e}/pos`).subscribe({next:async i=>{try{P.doAction("ns-before-load-order",{order:i})}catch(a){return s(a)}this.options.getValue(),i={...this.defaultOrder(),...i};const r=[];for(let a=0;a<i.products.length;a++){const l=i.products[a];l.product===null&&(l.product={mode:"custom",name:l.name,unit_id:l.unit_id,unit_quantities:[await this.defineQuantities(l)]}),l.$original=()=>l.product,l.$quantities=()=>{let u=l.product.unit_quantities.filter(h=>+h.id==+l.unit_quantity_id||h.id===void 0)[0];return l.mode==="custom"&&(u.custom_price_edit=l.unit_price,u.custom_price_with_tax=l.price_with_tax,u.custom_price_without_tax=l.price_without_tax,u.custom_price_tax=l.tax_value),u},r.push(l)}i.type=Object.values(this.types.getValue()).filter(a=>a.identifier===i.type)[0],i.addresses={shipping:i.shipping_address,billing:i.billing_address},delete i.shipping_address,delete i.billing_address,this.buildOrder(i),this.buildProducts(r),await this.selectCustomer(i.customer),t(i)},error:i=>s(i)})})}buildOrder(e){this.order.next(e)}buildProducts(e){this.recomputeProducts(e),this.products.next(e),P.doAction("ns-after-cart-changed")}printOrderReceipt(e,t){const s=this.options.getValue();if(s.ns_pos_printing_enabled_for==="disabled")return!1;if(s.ns_pos_printing_enabled_for==="all_orders")this.print.process(e.id,"sale",t);else if(s.ns_pos_printing_enabled_for==="partially_paid_orders"&&["paid","partially_paid"].includes(e.payment_status))this.print.process(e.id,"sale",t);else if(s.ns_pos_printing_enabled_for==="only_paid_orders"&&["paid"].includes(e.payment_status))this.print.process(e.id,"sale",t);else return!1}computePaid(){const e=this._order.getValue();e.tendered=0,e.payments.length>0&&(e.tendered=e.payments.map(t=>t.value).reduce((t,s)=>s+t)),e.tendered>=e.total?e.payment_status="paid":e.tendered>0&&e.tendered<e.total&&(e.payment_status="partially_paid"),e.change=e.tendered-e.total,this._order.next(e)}setPaymentActive(e){const t=this._paymentsType.getValue();t.forEach(s=>{s.identifier===e.identifier?s.selected=!0:s.selected=!1}),this._paymentsType.next(t)}definedPaymentsType(e){this._paymentsType.next(e)}selectCustomer(e){return new Promise((t,s)=>{const i=this.order.getValue(),r=Object.assign(e.billing||{},{});if(r.id!==void 0&&delete r.id,i.customer=e,i.customer_id=e.id,i.addresses.billing=r,this.order.next(i),e.group===void 0||e.group===null)T.get(`/api/customers/${e.id}/group`).subscribe({next:a=>{i.customer.group=a,this.order.next(i),t(i)},error:a=>{s(a)}});else return t(i)})}updateCart(e,t){for(let s in t)t[s]!==void 0&&(e[s]=t[s]);this.order.next(e),this.refreshCart()}checkCart(){const e=this.order.getValue(),t=[];e.coupons.forEach(s=>{let i=!0;s.products.length>0&&(i=e.products.filter(a=>s.products.map(l=>l.product_id).includes(a.product_id)).length>0,!i&&t.indexOf(s)===-1&&t.push(s));let r=!0;s.categories.length>0&&(r=e.products.filter(a=>s.categories.map(l=>l.category_id).includes(a.$original().category_id)).length>0,!r&&t.indexOf(s)===-1&&t.push(s))}),t.forEach(s=>{f.error(d(`The coupons "%s" has been removed from the cart, as it's required conditions are no more meet.`).replace("%s",s.name),d("Okay"),{duration:6e3}).subscribe(),this.removeCoupon(s)})}async refreshCart(){this.checkCart();const e=this.products.getValue();let t=this.order.getValue(),s=this.options.getValue().ns_pos_price_with_tax;const i=e.filter(p=>p.product_type!=="dynamic").map(p=>s==="yes"?p.total_price_with_tax:p.total_price_without_tax);if(i.length>0){let p=i.reduce((V,R)=>V+R),k=0,D=e.filter(V=>V.product_type==="dynamic").map(V=>(V.unit_price=p*V.rate/100,V.total_price=V.unit_price*V.quantity,V.total_price));D.length>0&&(k=D.reduce((V,R)=>V+R)),t.subtotal=p+k}else t.subtotal=0;const r=t.coupons.map(p=>p.type==="percentage_discount"?(p.value=t.subtotal*p.discount_value/100,p.value):(p.value=p.discount_value,p.value));t.total_coupons=0,r.length>0&&(t.total_coupons=r.reduce((p,k)=>p+k)),t.discount_type==="percentage"&&(t.discount=t.discount_percentage*t.subtotal/100),t.discount>t.subtotal&&t.total_coupons===0&&(t.discount=t.subtotal,f.info(d("The discount has been set to the cart subtotal.")).subscribe()),t.tax_value=0,t.total_tax_value=0,this.order.next(t);try{t=(await this.computeTaxes()).data.order}catch(p){p!==!1&&p.message!==void 0&&f.error(p.message||d("An unexpected error has occurred while fecthing taxes."),d("OKAY"),{duration:0}).subscribe()}const a=e.map(p=>p.tax_type==="inclusive"?p.tax_value:0);a.length>0&&a.reduce((p,k)=>p+k);const l=t.tax_type,u=this.options.getValue().ns_pos_vat;let h=0;["flat_vat","variable_vat","products_vat","products_flat_vat","products_variable_vat"].includes(u)&&(h=t.total_tax_value),l==="exclusive"?t.total=+(t.subtotal+(t.shipping||0)+h-t.discount-t.total_coupons).toFixed(ns.currency.ns_currency_precision):t.total=+(t.subtotal+(t.shipping||0)-t.discount-t.total_coupons).toFixed(ns.currency.ns_currency_precision),this.order.next(t),P.doAction("ns-cart-after-refreshed",t)}getStockUsage(e,t){const s=this._products.getValue().filter(i=>i.product_id===e&&i.unit_quantity_id===t).map(i=>i.quantity);return s.length>0?s.reduce((i,r)=>i+r):0}async addToCart(e){let t=new Object,s={product_id:e.id||0,name:e.name,discount_type:"percentage",discount:0,discount_percentage:0,product_type:e.product_type||"product",rate:e.rate||0,quantity:e.quantity||0,tax_group_id:e.tax_group_id,tax_type:e.tax_type||void 0,tax_value:0,unit_id:e.unit_id||0,unit_price:e.unit_price||0,price_with_tax:e.price_with_tax||0,price_without_tax:e.price_without_tax||0,unit_name:e.unit_name||"",total_price:0,total_price_without_tax:0,total_price_with_tax:0,mode:e.mode||"normal",$original:e.$original||(()=>e),$quantities:e.$quantities||void 0};if(this._processingAddQueue=!0,s.product_id!==0)for(let a in this.addToCartQueue)try{const u=await new this.addToCartQueue[a](s).run(t);t={...t,...u}}catch(l){if(l===!1)return this._processingAddQueue=!1,!1}this._processingAddQueue=!1,s={...s,...t};const i=this._products.getValue();if(this.settings.getValue().ns_pos_items_merge){const a=i.filter(l=>l.product_id===s.product_id&&l.tax_group_id===s.tax_group_id&&l.unit_id===s.unit_id&&l.unit_quantity_id===s.unit_quantity_id);a.length>0?a[0].quantity+=s.quantity:i.unshift(s)}else i.unshift(s);this.recomputeProducts(i),this.products.next(i);const r=this.options.getValue().ns_pos_new_item_audio;r.length>0&&new Audio(r).play(),P.doAction("ns-after-cart-changed")}defineTypes(e){this._types.next(e)}removeProduct(e){const t=this._products.getValue(),s=t.indexOf(e);t.splice(s,1),this.products.next(t),P.doAction("ns-after-cart-changed")}updateProduct(e,t,s=null){const i=this._products.getValue();s=s===null?i.indexOf(e):s,s=s===-1?0:s,i[s]={...e,...t},this.recomputeProducts(i),this.products.next(i),P.doAction("ns-after-cart-changed")}recomputeProducts(e=null){e.forEach(t=>{this.computeProduct(t)})}getProductUnitPrice(e,t){switch(e){case"custom":return t.custom_price_edit;case"normal":return t.sale_price_edit;case"wholesale":return t.wholesale_price_edit}}computeProductTax(e){switch(e.mode){case"custom":return this.computeCustomProductTax(e);case"normal":return this.computeNormalProductTax(e);case"wholesale":return this.computeWholesaleProductTax(e);default:return e}}proceedProductTaxComputation(e,t){const s=e.$original(),i=s.tax_group;let r=this.getProductUnitPrice(e.mode,e.$quantities()),a=0,l=this.getProductUnitPrice(e.mode,e.$quantities());if(i!=null&&i.taxes!==void 0){let u=0;switch(i.taxes.length>0&&(u=i.taxes.map(h=>h.rate).reduce((h,p)=>h+p)),s.tax_type){case"inclusive":r=this.getPriceWithoutTax(t,u,s.tax_type),l=t;break;case"exclusive":r=t,l=this.getPriceWithTax(t,u,s.tax_type);break}a=this.getVatValue(t,u,s.tax_type)}return{price_without_tax:r,tax_value:a,price_with_tax:l}}computeCustomProductTax(e){e.$original();const t=e.$quantities(),s=this.proceedProductTaxComputation(e,t.custom_price_edit);return t.custom_price_without_tax=s.price_without_tax,t.custom_price_with_tax=s.price_with_tax,t.custom_price_tax=s.tax_value,e.$quantities=()=>t,e}computeNormalProductTax(e){const t=e.$quantities(),s=this.proceedProductTaxComputation(e,t.sale_price_edit);return t.sale_price_without_tax=s.price_without_tax,t.sale_price_with_tax=s.price_with_tax,t.sale_price_tax=s.tax_value,e.$quantities=()=>t,e}computeWholesaleProductTax(e){const t=e.$quantities(),s=this.proceedProductTaxComputation(e,t.wholesale_price_edit);return t.wholesale_price_without_tax=s.price_without_tax,t.wholesale_price_with_tax=s.price_with_tax,t.wholesale_price_tax=s.tax_value,e.$quantities=()=>t,e}getPrice(e,t,s){switch(t){case"normal":return e["sale_price_"+s];case"wholesale":return e["wholesale_price_"+s];case"custom":return e["custom_price_"+s]}}computeProduct(e){e.product_type==="product"&&(e.mode==="normal"?(e.unit_price=this.getSalePrice(e.$quantities(),e.$original()),e.tax_value=x(e.$quantities().sale_price_tax).multiply(e.quantity).done()):e.mode==="wholesale"&&(e.unit_price=this.getWholesalePrice(e.$quantities(),e.$original()),e.tax_value=x(e.$quantities().wholesale_price_tax).multiply(e.quantity).done()),e.mode==="custom"&&(e.unit_price=this.getCustomPrice(e.$quantities(),e.$original()),e.tax_value=x(e.$quantities().custom_price_tax).multiply(e.quantity).done()));let t=0,s=0,i=this.getPrice(e.$quantities(),e.mode,"with_tax"),r=this.getPrice(e.$quantities(),e.mode,"without_tax");["flat","percentage"].includes(e.discount_type)&&(e.discount_type==="percentage"?(e.discount=x(x(x(e.unit_price).multiply(e.discount_percentage).done()).divide(100).done()).multiply(e.quantity).done(),t=x(x(x(r).multiply(e.discount_percentage).done()).divide(100).done()).multiply(e.quantity).done(),s=x(x(x(i).multiply(e.discount_percentage).done()).divide(100).done()).multiply(e.quantity).done()):(t=e.discount,s=e.discount)),e.price_with_tax=i,e.price_without_tax=r,e.total_price=x(x(e.unit_price).multiply(e.quantity).done()).subtract(e.discount).done(),e.total_price_with_tax=x(x(i).multiply(e.quantity).done()).subtract(s).done(),e.total_price_without_tax=x(x(r).multiply(e.quantity).done()).subtract(t).done(),P.doAction("ns-after-product-computed",e)}loadCustomer(e){return T.get(`/api/customers/${e}`)}defineSettings(e){this._settings.next(e)}voidOrder(e){e.id!==void 0?["hold"].includes(e.payment_status)?v.show(W,{title:d("Order Deletion"),message:d("The current order will be deleted as no payment has been made so far."),onAction:t=>{t&&T.delete(`/api/orders/${e.id}`).subscribe({next:s=>{f.success(s.message).subscribe(),this.reset()},error:s=>f.error(s.message).subscribe()})}}):v.show(ms,{title:d("Void The Order"),message:d("The current order will be void. This will cancel the transaction, but the order won't be deleted. Further details about the operation will be tracked on the report. Consider providing the reason of this operation."),onAction:t=>{t!==!1&&T.post(`/api/orders/${e.id}/void`,{reason:t}).subscribe({next:s=>{f.success(s.message).subscribe(),this.reset()},error:s=>f.error(s.message).subscribe()})}}):f.error(d("Unable to void an unpaid order.")).subscribe()}async triggerOrderTypeSelection(e){for(let t=0;t<this.orderTypeQueue.length;t++)await this.orderTypeQueue[t].promise(e)}set(e,t){const s=this.settings.getValue();s[e]=t,this.settings.next(s)}unset(e){const t=this.settings.getValue();delete t[e],this.settings.next(t)}get(e){return this.settings.getValue()[e]}destroy(){this._products.unsubscribe(),this._customers.unsubscribe(),this._types.unsubscribe(),this._breadcrumbs.unsubscribe(),this._paymentsType.unsubscribe(),this._screen.unsubscribe(),this._order.unsubscribe(),this._settings.unsubscribe()}};window.POS=new J;window.POSClass=J;
