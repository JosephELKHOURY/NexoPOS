import{p as P,e as L,F as V,b as f,a as b}from"./bootstrap-f85d1704.js";import{_ as d}from"./currency-ab26e44d.js";import{_ as T}from"./_plugin-vue_export-helper-c27b6911.js";import"./npm~@dicebear~avatars_-e718895d.js";import"./npm~@dicebear~avatars-avataaars-sprites_-c793f8f6.js";import"./npm~moment-a9aaa855.js";import{n as N}from"./ns-prompt-popup-e2869fb5.js";import"./npm~vue2-daterange-picker-ccd86bea.js";import"./npm~vuedraggable-c7d6faf7.js";import"./npm~vue-upload-component-6f0f62ed.js";import"./npm~lodash-9a4afe3d.js";import{b as S}from"./npm~qrcode-1ac85ed4.js";import{m as F}from"./npm~@vue~runtime-dom_-725465db.js";import{an as p,af as i,G as l,H as e,aJ as q,c as u,aH as _,M as m,F as y,al as g,z as B,A as v}from"./npm~@vue~runtime-core_-19758cc2.js";import{V as o}from"./npm~@vue~shared_-951a29c4.js";import"./npm~laravel-echo-198fd56d.js";import"./npm~pusher-js-bdf0b3b7.js";import"./npm~@ckeditor~ckeditor5-build-classic_-27365139.js";import"./npm~axios-c24e582b.js";import"./npm~chart.js-3fed1729.js";import"./npm~rxjs-eeb06f17.js";import"./npm~tslib-8dbab242.js";import"./npm~vue-34b803c9.js";import"./npm~@vue~compiler-dom_-614ecb28.js";import"./npm~@vue~compiler-core_-eb33010d.js";import"./npm~@vue~reactivity_-7ae94d11.js";import"./npm~rx-da74c705.js";import"./npm~@wordpress~hooks_-bd0b7221.js";import"./npm~mathjs-befa2efb.js";import"./npm~@babel~runtime_-698f0f51.js";import"./npm~decimal.js-d133ee8e.js";import"./npm~complex.js-2f8f27d8.js";import"./npm~fraction.js-704ae1f4.js";import"./npm~typed-function-de33f2d8.js";import"./npm~seedrandom-4e17e537.js";import"./npm~javascript-natural-sort-82d7d2c3.js";import"./npm~escape-latex-6c71499e.js";import"./npm~numeral-85b533a7.js";import"./npm~currency.js-57f74176.js";import"./npm~pure-color-7e91fe3a.js";import"./npm~svgson-b28014ad.js";import"./npm~deep-rename-keys-b2342f4f.js";import"./npm~kind-of-f578382b.js";import"./npm~is-buffer-793dba8c.js";import"./npm~rename-keys-392f1d0e.js";import"./npm~xml-reader-442daf8d.js";import"./npm~eventemitter3-3e95be7d.js";import"./npm~xml-lexer-4446ceee.js";import"./npm~@ckeditor~ckeditor5-vue_-057f53f2.js";import"./npm~sortablejs-314556ad.js";import"./npm~encode-utf8-f813de00.js";import"./npm~dijkstrajs-f906a09e.js";const U={name:"ns-token-output",props:["popup"],data(){return{accessToken:"",qrCodeSRC:""}},mounted(){this.accessToken=this.popup.params.result.data.token.plainTextToken,this.popupCloser(),setTimeout(()=>{this.$refs.token.select(),this.$refs.token.setSelectionRange(0,99999),this.setQRCode()},100)},methods:{__:d,popupResolver:P,popupCloser:L,setQRCode(){S.toDataURL(this.accessToken).then(n=>{this.qrCodeSRC=n}).catch(n=>{console.log(n)})},close(){navigator.clipboard.writeText(this.$refs.token.value),this.popupResolver(!0)}}},j={id:"alert-popup",class:"w-6/7-screen md:w-4/7-screen lg:w-3/7-screen flex flex-col shadow-lg"},D={class:"flex items-center justify-center flex-col flex-auto p-4"},I={class:"text-3xl font-body mb-4"},H=["src"],M={class:"text-xs text-secondary py-2"},O=e("br",null,null,-1),Q={class:"py-4 text-center"},Y={class:"action-buttons flex border-t justify-end items-center p-2"};function E(n,s,c,w,r,t){const k=p("ns-button");return i(),l("div",j,[e("div",D,[e("h2",I,o(t.__("API Token")),1),e("img",{id:"token-qrcode",class:"border-2 w-64 h-64",src:r.qrCodeSRC},null,8,H),e("p",M,o(t.__("This QR code is provided to ease authentication on external applications.")),1),O,e("p",Q,o(t.__(`The API token has been generated. Make sure to copy this code on a safe place as it will only be displayed once.
                If you loose this token, you'll need to revoke it and generate a new one.`)),1),q(e("input",{ref:"token","onUpdate:modelValue":s[0]||(s[0]=h=>r.accessToken=h),readonly:"",type:"text",class:"my-2 p-2 w-full border-2 rounded border-input-edge bg-input-background"},null,512),[[F,r.accessToken]])]),e("div",Y,[u(k,{onClick:s[1]||(s[1]=h=>t.close()),type:"info"},{default:_(()=>[m(o(t.__("Copy And Close")),1)]),_:1})])])}const G=T(U,[["render",E]]),z={name:"ns-token",data(){return{validation:new V,tokens:[],isLoading:!1,fields:[{type:"text",label:d("Token Name"),name:"name",description:d("This will be used to identifier the token."),validation:"required"}]}},methods:{__:d,createToken(){if(!this.validation.validateFields(this.fields))return f.error(d("Unable to proceed, the form is not valid.")).subscribe();b.post("/api/users/create-token",this.validation.extractFields(this.fields)).subscribe(async n=>{try{await new Promise((s,c)=>{Popup.show(G,{resolve:s,reject:c,result:n})}),this.loadTokens()}catch(s){console.log(s)}})},revokeToken(n){Popup.show(N,{title:d("Confirm Your Action"),message:d("You're about to delete a token that might be in use by an external app. Deleting will prevent that app from accessing the API. Would you like to proceed ?"),onAction:s=>{s&&b.delete(`/api/users/tokens/${n.id}`).subscribe({next:c=>{this.loadTokens(),f.success(c.message).subscribe()},error:c=>{f.error(c.message||"An unexpected error occured.").subscribe()}})}})},loadTokens(){this.isLoading=!0,b.get("/api/users/tokens").subscribe({next:n=>{this.isLoading=!1,this.tokens=n},error:n=>{f.error("Unable to load the token. An unexpected error occured.").subscribe()}})}},mounted(){this.fields=this.validation.createFields(this.fields),this.loadTokens()}},J={class:"-mx-2"},W={class:"px-2 w-full md:w-1/2"},K={class:"mb-4"},X={class:"my-2"},Z={class:"flex justify-end"},$={class:"py-2 border-b-4 text-center border-box-edge text-xl"},ee={key:0},te={class:"flex flex-col"},oe={class:"text-lg"},se={class:"text-xs text-tertiary"},ne={class:"text-xs text-tertiary"},re={class:"text-xs text-tertiary"},ie={key:1,class:"my-4"},ae={key:2,class:"mt-2"},le={class:"text-center text-tertiary text-sm my-4"};function ce(n,s,c,w,r,t){const k=p("ns-notice"),h=p("ns-field"),C=p("ns-button"),R=p("ns-close-button"),A=p("ns-spinner");return i(),l("div",J,[e("div",W,[e("div",K,[u(k,null,{title:_(()=>[m(o(t.__("About Token")),1)]),description:_(()=>[m(o(t.__(`Token are used to provide a secure access to NexoPOS resources without having to share your personal username and password.
                       Once generated, they won't expires until you explicitely revoke it.`)),1)]),_:1})]),e("div",X,[(i(!0),l(y,null,g(r.fields,(a,x)=>(i(),B(h,{key:x,field:a},null,8,["field"]))),128)),e("div",Z,[u(C,{onClick:s[0]||(s[0]=a=>t.createToken()),type:"info"},{default:_(()=>[m(o(t.__("Save Token")),1)]),_:1})])]),e("div",null,[e("h3",$,o(t.__("Generated Tokens")),1),r.tokens.length>0&&!r.isLoading?(i(),l("ul",ee,[(i(!0),l(y,null,g(r.tokens,(a,x)=>(i(),l("li",{key:x,class:"p-2 border-b flex justify-between items-center border-box-edge"},[e("div",te,[e("h4",oe,o(a.name),1),e("div",null,[e("ul",null,[e("li",null,[e("span",se,o(t.__("Created"))+": "+o(a.created_at),1)]),e("li",null,[e("span",ne,o(t.__("Last Use"))+": "+o(a.last_used_at||t.__("Never")),1)]),e("li",null,[e("span",re,o(t.__("Expires"))+": "+o(a.expires_at||t.__("Never")),1)])])])]),e("div",null,[u(R,{onClick:de=>t.revokeToken(a),class:"px-2"},{default:_(()=>[m(o(t.__("Revoke")),1)]),_:2},1032,["onClick"])])]))),128))])):v("",!0),r.isLoading?(i(),l("div",ie,[u(A)])):v("",!0),!r.isLoading&&r.tokens.length===0?(i(),l("div",ae,[e("div",le,o(t.__("You haven't yet generated any token for your account. Create one to get started.")),1)])):v("",!0)])])])}const ct=T(z,[["render",ce]]);export{ct as default};
